Begin
for c in (select table_name from user_tables) loop
execute immediate ('drop table '||c.table_name||' cascade constraints');
end loop;
End; 
/

CREATE TABLE DEPARTMENT (
  DEPTNO CHAR(6) CONSTRAINT DEPT_DEPTNO_PK  PRIMARY KEY,
  DNAME VARCHAR(25) NOT NULL,
  LOC VARCHAR(20),
  INSNO CHAR(9) NOT NULL 
);
  
ALTER TABLE DEPARTMENT
  ADD CONSTRAINT DEPT_INSTNO_FK FOREIGN KEY (INSNO) REFERENCES INSTRUCTOR;
 
ALTER TABLE DEPARTMENT
  ADD CONSTRAINT DEPT_INSTNO_UQ UNIQUE(INSNO);

--here for char, you can have however many chars u want as long as it doesn't exceed the limit
--check online efficiency for char, varchar difference
INSERT INTO DEPARTMENT VALUES('1', 'Computer Science', 'Montreal', '1200001'); --the instno has to reference an instructor in the instructor table

-- there can only be one head for each dpt
INSERT INTO DEPARTMENT VALUES('2', 'Human Resources', 'Montreal', '1200002');
INSERT INTO DEPARTMENT VALUES('3', 'Administration', 'Montreal', '1200003');

CREATE TABLE INSTRUCTOR (
  INSNO CHAR(9) CONSTRAINT INS_INSNO_PK PRIMARY KEY,
  FNAME VARCHAR(20) NOT NULL,
  LNAME VARCHAR(20) NOT NULL,
  DEPTNO CHAR(6),
  CONSTRAINT INS_DEPTNO_FK FOREIGN KEY (DEPTNO) REFERENCES DEPARTMENT
);

INSERT INTO INSTRUCTOR VALUES('1200001', 'Albert', 'Magnus', NULL);
INSERT INTO INSTRUCTOR VALUES('1200002', 'Deano', 'Magnus', NULL);
INSERT INTO INSTRUCTOR VALUES('1200003', 'Saimon', 'Magnus', NULL);
INSERT INTO INSTRUCTOR VALUES('1200004', 'George', 'Magnus', NULL);
INSERT INTO INSTRUCTOR VALUES('1200005', 'George', 'Magnus', NULL);
INSERT INTO INSTRUCTOR VALUES('1200006', 'George', 'Magnus', NULL);
INSERT INTO INSTRUCTOR VALUES('1200007', 'George', 'Magnus', NULL);
          
CREATE TABLE COURSE (
  CID CHAR(6) CONSTRAINT COURSE_CID_PK PRIMARY KEY,
  TITLE VARCHAR(25) UNIQUE,
  INSTID CHAR(9),
  DEPTNO CHAR(6),
  CONSTRAINT COURSE_INSID_FK FOREIGN KEY (INSTID) REFERENCES INSTRUCTOR,
  CONSTRAINT COURSE_DEPTNO_FK FOREIGN KEY (DEPTNO) REFERENCES DEPARTMENT
);
  
INSERT INTO COURSE VALUES('DB100', 'Databases', '1200007', '1');
INSERT INTO COURSE VALUES('PR100', 'Programming 1', '1200006', '1');
INSERT INTO COURSE VALUES('PR200', 'Programming 2', '1200006', '1');
INSERT INTO COURSE VALUES('CS100', 'Intro to Computer Science', '1200004', '1');
INSERT INTO COURSE VALUES('GP100', 'Game Programming', '1200002', '1');
INSERT INTO COURSE VALUES('CS200', 'Computer Environments', '1200005', '1');
INSERT INTO COURSE VALUES('MA100', 'Math Concepts', '1200004', '1');
INSERT INTO COURSE VALUES('PR300', 'Data Structures', '1200006', '1');

CREATE TABLE STUDENT (
  SID CHAR(9) CONSTRAINT STUDENT_SID_PK PRIMARY KEY,
  FNAME VARCHAR(20) NOT NULL,
  LNAME VARCHAR(20) NOT NULL,
  DOB DATE
);
  
-- we can use this to format ALL dates 
ALTER SESSION SET NLS_DATE_FORMAT = 'MM/DD/YYYY';

--or we can use the to_date function, to_date('12/14/1997', 'mm/dd/yy')
INSERT INTO STUDENT VALUES('190001', 'Saimon', 'Saimon', '12/14/1997');
INSERT INTO STUDENT VALUES('190002', 'Bill', 'Saimon', '08/24/1942');
INSERT INTO STUDENT VALUES('190003', 'Albert', 'Magnus', '07/05/1997');
INSERT INTO STUDENT VALUES('190004', 'Jonathan', 'Parker', '04/14/2000');


CREATE TABLE ENROLS (
  SID CHAR(9),
  CID CHAR(6),
  CONSTRAINT ENROL_SID_CID_PK PRIMARY KEY (SID, CID),
  CONSTRAINT ENROL_SID_FK FOREIGN KEY (SID) REFERENCES STUDENT,
  CONSTRAINT ENROL_CID_FK FOREIGN KEY (CID) REFERENCES COURSE
);
  
ALTER TABLE ENROLS
  ADD GRADE NUMBER(5, 2) CHECK (GRADE >= 0 AND GRADE <= 100);
  
INSERT INTO ENROLS VALUES('190001', 'DB100');
INSERT INTO ENROLS VALUES('190001', 'PR100', '89.7');
INSERT INTO ENROLS VALUES('190001', 'CS100', '37.7');
INSERT INTO ENROLS VALUES('190001', 'MA100', '100');
INSERT INTO ENROLS VALUES('190002', 'DB100', '94.3');
INSERT INTO ENROLS VALUES('190003', 'PR100', '67');
INSERT INTO ENROLS VALUES('190004', 'CS100', '74.7');
INSERT INTO ENROLS VALUES('190004', 'MA100', '91.2');

COMMIT;

CREATE TABLE SKILL 
  INSNO CHAR(9),
  SKILL VARCHAR(25),
  CONSTRAINT SKILL_INS_SKILL_PK PRIMARY KEY(INSNO, SKILL),
  CONSTRAINT SKILL_INS_FK FOREIGN KEY(INSNO) REFERENCES INSTRUCTOR
);
  
INSERT INTO SKILL VALUES('1200007', 'MC.S');
INSERT INTO SKILL VALUES('1200007', 'PHD');
INSERT INTO SKILL VALUES('1200004', 'MC.S');

--rollback only applies for dml ! ddl (this would require changing the database structure so it's a nono)
ROLLBACK;

SELECT * FROM INSTRUCTOR
WHERE DEPTNO IS NULL;

UPDATE INSTRUCTOR
SET DEPTNO = '1'
WHERE DEPTNO IS NULL;
  
DELETE ENROLS
WHERE SID = '190002'

ROLLBACK;

--THE NB OF INSTRUCTORS IN EACH DEPARTMENT
SELECT DEPTNO, COUNT(INSNO) FROM INSTRUCTOR GROUP BY DEPTNO;

--LIST THE NAME OF INSTRUCTORS AND THEIR DEPARTMENTS NAME
SELECT FNAME, LNAME, DNAME
FROM DEPARTMENT D JOIN INSTRUCTOR I
ON D.DEPTNO = I.DEPTNO;
  
  
  
  
  
  
  
